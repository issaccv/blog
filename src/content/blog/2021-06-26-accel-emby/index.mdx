---
title: "Unraid 加速 Emby 刮削"
description: "媒体服务器的刮削可能是很多人使用Emby、Plex或者Jellyfin的最初动力，但是国内网络环境的参差不齐导致了刮削体验十分割裂。之前玩unraid的时候使用过一段时间的Jellyfin，免费当然百般都好，直到我用In..."
date: 2021-06-26
tags: []
# image: './banner.png'
authors: ['issacc']
---

媒体服务器的刮削可能是很多人使用Emby、Plex或者Jellyfin的最初动力，但是国内网络环境的参差不齐导致了刮削体验十分割裂。

之前玩unraid的时候使用过一段时间的Jellyfin，免费当然百般都好，直到我用Infuse准备添加媒体服务时发现，根本不提供Jellyfin选项，只有Emby和Plex。虽然Plex之前开过一波不到300的永久车，但是我犹豫了，所以没有赶上。（其实是因为穷）所以不得已就要切换到Emby，由于Emby有非常成熟的破解方案，并且Jellyfin也来自于其早期版本，所以体验上算是无缝切换。（甚至某些版本的数据库都可以直接拷贝）

## 使用TMM手动刮削

使用Jellyfin的时候因为一直使用TinyMediaManager进行手动的媒体刮削，当然这个TMM是跑在我的电脑上的，而电脑上的网络环境非常好，所以刮削不是什么问题。不过TMM的最大槽点应该是对电视剧集的季信息的刮削，如果你的文件中包含了年份，比如2019，那么TMM多半就会在nfo文件里写上S19E20这种信息，这直接导致了Emby在扫描媒体库的时候只能扫到一集（因为剩下所有的nfo中的集信息都是完全一样的）。不过也有解决办法，比如手动调整，不过对于我这样的懒蛋来说，动手是不可能动手的。还有把TMM做进Docker里，用WebGUI进行刮削的方法，奈何我的Unraid是跑在N3450上的，所以这个也pass。

## 自动刮削

于是我就把主意打到了Emby自带的刮削上，其实识别精准度还蛮高的，而且也能自动下载海报同人图什么的，值得一试。这就面临了新的问题：tmdb、tvdb、fanart等服务的访问。

### 软路由

如果你有软路由，那么很简单，只要把上面几个服务的域名放到某个列表里：`*.themoviedb.org*.tmdb.org*.thetvdb.com*.fanart.tv`就可以实现比较不错的刮削体验，但是我相信如果你看得到这篇文章，多半是已经在这个项目上经历了一番搜寻，这也就意味着你和我一样，没有软路由。

### 购买服务or自己动手

当然没有软路由不意味着我们就没有办法加速刮削的过程，只不过我们得动动脑子。之前在研究Emby破解方法的时候看到了一些提供付费加速服务的网站，本着事实就是原则，我发现其实提供加速服务的原理还不完全相同。第一种是通过修改System.Net.Http.dll这个文件，实现对上述刮削服务的劫持，将请求重定向到搭建好的反向代理网站。第二种则更简单粗暴一点，直接要求客户端安装自己签发的根证书文件，实现反代加速。当然这两种方法都非常依赖服务提供方的反代服务器，万一哪天服务商跑路或者服务器抽风，刮削也就跟着不行了，所以有没有什么好办法呢？比如，直接给Emby设置代理？虽然网上有一些教你改Host的办法，但是Host毕竟是权宜之计，长久不了。抱着死马当活马医的心态，我在unraid里新起了一个小猫咪，然后将小猫咪的网络模式改为host（当然这步不是必须的），在Emby的模版中添加了两条环境变量。

```
--env HTTP_PROXY="http://172.17.0.1:7890/" --env HTTPS_PROXY="http://172.17.0.1:7890/"
```
重启容器后，发现可以顺畅下载图片，另外也可以在小猫咪的网络日志中发现上述刮削服务的域名，这说明我们确实给Emby套上了代理。这里使用172.17.0.1是因为Emby是桥接的网络模式，只能通过Docker0网桥来访问宿主机端口。这里我使用的是linuxserver的Emby镜像，官方原版的Emby镜像是buildfromscratch的，我没有使用过，所以我这个教程也只能保证在linuxserver的镜像上生效。当然，如果你想偷懒，使用已经破解好的版本，不妨试试这个[[issacc/embycrack](https://hub.docker.com/r/issacc/embycrack)]。

**References:**
- Emby国内加速服务安装方法http://www.fanooo.com/archives/930
- Emby破解版完全食用方法https://neko.re/archives/128.html
- https://mba.mvnas.com
